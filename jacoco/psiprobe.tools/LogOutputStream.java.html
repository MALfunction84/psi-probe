<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LogOutputStream.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">psi-probe-core</a> &gt; <a href="index.source.html" class="el_package">psiprobe.tools</a> &gt; <span class="el_source">LogOutputStream.java</span></div><h1>LogOutputStream.java</h1><pre class="source lang-java linenums">/*
 * Licensed under the GPL License. You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   https://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 *
 * THIS PACKAGE IS PROVIDED &quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE.
 */
package psiprobe.tools;

import java.io.IOException;
import java.io.OutputStream;
import java.io.PrintStream;
import java.nio.charset.StandardCharsets;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * An {@code OutputStream} which writes to a commons-logging {@code Log} at a particular level.
 */
public final class LogOutputStream extends OutputStream {

  /** The Constant INTERNAL_LOGGER. */
<span class="fc" id="L27">  private static final Logger INTERNAL_LOGGER = LoggerFactory.getLogger(LogOutputStream.class);</span>

  /** The Constant LEVEL_OFF. */
  public static final int LEVEL_OFF = 0;

  /** The Constant LEVEL_TRACE. */
  public static final int LEVEL_TRACE = 1;

  /** The Constant LEVEL_DEBUG. */
  public static final int LEVEL_DEBUG = 2;

  /** The Constant LEVEL_INFO. */
  public static final int LEVEL_INFO = 3;

  /** The Constant LEVEL_WARN. */
  public static final int LEVEL_WARN = 4;

  /** The Constant LEVEL_ERROR. */
  public static final int LEVEL_ERROR = 5;

  /** The Constant LEVEL_FATAL. */
  public static final int LEVEL_FATAL = 6;

  /** The logger. */
  private final Logger logger;

  /** The level. */
  private final int level;

  /** The buf. */
<span class="fc" id="L57">  private final StringBuilder buf = new StringBuilder();</span>

  /**
   * Creates a new instance of {@code LogOutputStream} which will write to a given {@code Log} at
   * the given level.
   *
   * @param log the {@code Log} to which to write
   * @param level the level at which to write
   */
<span class="fc" id="L66">  private LogOutputStream(Logger log, int level) {</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">    if (log == null) {</span>
<span class="nc" id="L68">      throw new IllegalArgumentException(&quot;Log cannot be null&quot;);</span>
    }
<span class="fc" id="L70">    this.logger = log;</span>
<span class="fc" id="L71">    this.level = level;</span>
<span class="fc" id="L72">  }</span>

  /**
   * Creates a {@code PrintStream} with autoFlush enabled which will write to the given {@code Log}
   * at the given level.
   *
   * @param log the {@code Log} to which to write
   * @param level the level at which to write
   *
   * @return a {@code PrintStream} that writes to the given log
   */
  public static PrintStream createPrintStream(Logger log, int level) {
<span class="fc" id="L84">    try (LogOutputStream logStream = new LogOutputStream(log, level)) {</span>
<span class="fc" id="L85">      return new PrintStream(logStream, true, StandardCharsets.UTF_8.name());</span>
<span class="nc" id="L86">    } catch (IOException e) {</span>
<span class="nc" id="L87">      INTERNAL_LOGGER.error(&quot;&quot;, e);</span>
    }
<span class="nc" id="L89">    return null;</span>
  }

  /**
   * Flushes the contents of this stream to its {@code Log}.
   */
  @Override
  public void flush() {
<span class="nc bnc" id="L97" title="All 2 branches missed.">    if (shouldWrite()) {</span>
<span class="nc" id="L98">      String message = buf.toString();</span>
<span class="nc" id="L99">      log(message);</span>
    }
<span class="nc" id="L101">    buf.setLength(0);</span>
<span class="nc" id="L102">  }</span>

  /**
   * Writes the specified {@code byte} to this stream.
   *
   * @param out the {@code byte} to write
   */
  @Override
  public void write(int out) {
<span class="pc bpc" id="L111" title="1 of 2 branches missed.">    if (shouldWrite()) {</span>
<span class="nc" id="L112">      char chr = (char) out;</span>
<span class="nc" id="L113">      buf.append(chr);</span>
    }
<span class="fc" id="L115">  }</span>

  /**
   * Returns the {@code Log} to which this stream writes.
   *
   * @return the {@code Log} to which this stream writes
   */
  public Logger getLog() {
<span class="nc" id="L123">    return logger;</span>
  }

  /**
   * Returns the level at which this stream writes to the {@code Log}.
   *
   * @return the level at which this stream writes to the {@code Log}
   */
  public int getLevel() {
<span class="nc" id="L132">    return level;</span>
  }

  /**
   * Determines if the {@code Log} is configured to accept messages at this stream's level.
   *
   * @return {@code true} if the level of the underlying {@code Log} is equal to or greater than the
   *         level assigned to this stream
   */
  private boolean shouldWrite() {
<span class="pc bpc" id="L142" title="5 of 6 branches missed.">    switch (level) {</span>
      case LEVEL_TRACE:
<span class="nc" id="L144">        return logger.isTraceEnabled();</span>
      case LEVEL_DEBUG:
<span class="nc" id="L146">        return logger.isDebugEnabled();</span>
      case LEVEL_INFO:
<span class="nc" id="L148">        return logger.isInfoEnabled();</span>
      case LEVEL_WARN:
<span class="nc" id="L150">        return logger.isWarnEnabled();</span>
      case LEVEL_ERROR:
<span class="fc" id="L152">        return logger.isErrorEnabled();</span>
      default:
<span class="nc" id="L154">        return false;</span>
    }
  }

  /**
   * Writes the given message to this stream's {@code Log} at this stream's level.
   *
   * @param message the message to be written
   */
  private void log(String message) {
<span class="nc bnc" id="L164" title="All 4 branches missed.">    if (message == null || message.isEmpty()) {</span>
<span class="nc" id="L165">      return;</span>
    }
<span class="nc bnc" id="L167" title="All 6 branches missed.">    switch (level) {</span>
      case LEVEL_TRACE:
<span class="nc" id="L169">        logger.trace(message);</span>
<span class="nc" id="L170">        break;</span>
      case LEVEL_DEBUG:
<span class="nc" id="L172">        logger.debug(message);</span>
<span class="nc" id="L173">        break;</span>
      case LEVEL_INFO:
<span class="nc" id="L175">        logger.info(message);</span>
<span class="nc" id="L176">        break;</span>
      case LEVEL_WARN:
<span class="nc" id="L178">        logger.warn(message);</span>
<span class="nc" id="L179">        break;</span>
      case LEVEL_ERROR:
<span class="nc" id="L181">        logger.error(message);</span>
<span class="nc" id="L182">        break;</span>
      default:
        // Don't log anything
        break;
    }
<span class="nc" id="L187">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>